# 【逆向】迷宫题学习笔记

------

## 一、题目背景

- 逆向分析一道迷宫题目，分析迷宫地图数据和程序控制逻辑，实现模拟玩家移动。
- 多关卡迷宫，共3关，每关地图为15×15。
- 玩家通过输入字符控制移动，目标是走到终点。

------

## 二、迷宫数据结构

- **存储方式**：所有迷宫关卡数据存储在一维整型数组 `dword_202020` 中。

- **关卡大小**：15×15 = 225个格子。

- **访问公式**：

  ```
  c
  
  
  复制编辑
  dword_202020[225 * level + 15 * row + col]
  ```

  - `level`：第几关，0开始计数。
  - `row`：行号，0~14。
  - `col`：列号，0~14。

------

## 三、数字含义总结

| 数字 | 含义         | 说明                     |
| ---- | ------------ | ------------------------ |
| 0    | 墙/障碍      | 不能通过的格子           |
| 1    | 空地         | 可以走的格子             |
| 3    | 玩家所在位置 | 表示玩家当前位置         |
| 4    | 终点         | 迷宫出口，玩家走到即获胜 |



------

## 四、主要全局变量

| 变量           | 作用                   |
| -------------- | ---------------------- |
| `dword_202020` | 存储所有关卡的地图数据 |
| `dword_202AB0` | 当前关卡索引（0~2）    |
| `dword_202AB4` | 玩家当前所在行号       |
| `dword_202AB8` | 玩家当前所在列号       |



------

## 五、关键函数解析

### 1. `sub_940`（主输入处理）

- 读取用户输入字符串，每个字符对应一次移动。
- 根据字符调用对应方向函数：
  - `'d'` → 向右 (`sub_E23()`)
  - `'s'` → 向下 (`sub_C5A()`)
  - `'w'` → 向上 (`sub_A92()`)
  - `'a'` → 向左 (`sub_FEC()`)
- 输入 `ESC` (27) 返回 `-1`，表示退出程序。
- 当方向函数返回1，表示当前关卡成功完成。
- 当完成第三关 (`dword_202AB0 == 2`) 打印成功flag。

### 2. 方向移动函数（示例以向右为例 `sub_E23`）

- 检查是否越界（比如右边界列号不能超过14）。
- 判断目标格子状态：
  - 如果是`1`，更新玩家位置：原位置改回`1`，目标位置改为`3`。返回`0`继续游戏。
  - 如果是`4`，表示到达终点，返回`1`表示胜利。
  - 其他情况不移动，返回`0`。

### 3. `sub_86C`（更新玩家位置）

- 遍历当前关卡地图，查找值为`3`的格子，即玩家当前位置。
- 更新全局变量`dword_202AB4`和`dword_202AB8`。

------

## 六、程序退出条件总结

- **退出方式一**：用户输入ESC(27)，`sub_940`返回`-1`，结束主循环，程序退出。
- **退出方式二**：玩家成功走到终点(格子值4)，对应方向函数返回`1`。
  - 如果当前是第三关，则程序打印flag，结束游戏。
  - 否则进入下一关，继续游戏。